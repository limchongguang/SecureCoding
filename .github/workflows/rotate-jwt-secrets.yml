name: Rotate JWT Secrets Daily

on:
  schedule:
    - cron: '0 16 * * *'  # Runs daily at midnight SGT
  workflow_dispatch:    # Allows manual trigger

jobs:
  rotate-secrets:
    runs-on: ubuntu-latest

    steps:
    - name: Generate new JWT secret key
      id: generate_key
      run: |
        echo "new_key=$(openssl rand -hex 32)" >> $GITHUB_OUTPUT

    - name: Update secrets
      uses: peter-evans/repository-secret@v1
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        secrets: |
          JWT_PREVIOUS_SECRET=${{ secrets.JWT_CURRENT_SECRET }}
          JWT_CURRENT_SECRET=${{ steps.generate_key.outputs.new_key }}
