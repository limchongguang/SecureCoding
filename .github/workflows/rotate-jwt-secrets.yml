name: Rotate JWT Secrets Daily
on:
  schedule:
    - cron: '0 16 * * *'  # Runs daily at midnight SGT (UTC+8)
  workflow_dispatch:    # Allows manual trigger

jobs:
  rotate-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Generate new JWT secret key
        id: generate_key
        run: |
          echo "new_key=$(openssl rand -hex 32)" >> $GITHUB_OUTPUT
      
      - name: Update JWT_PREVIOUS_SECRET
        run: |
          gh secret set JWT_PREVIOUS_SECRET --body "${{ secrets.JWT_CURRENT_SECRET }}"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Update JWT_CURRENT_SECRET
        run: |
          gh secret set JWT_CURRENT_SECRET --body "${{ steps.generate_key.outputs.new_key }}"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
